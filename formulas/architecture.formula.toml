description = "Architecture decision workflow with mandatory human gates. Must NOT proceed to implementation without human direction. Design choices with lasting consequences."
formula = "architecture"
type = "workflow"
version = 1

[[steps]]
id = "research"
title = "Research {{topic}}"
description = "Investigate the problem space. Understand constraints, existing patterns, and prior art. Document findings. Do NOT propose solutions yet — understand the problem first."
acceptance = "Problem space documented with constraints, existing patterns, and relevant prior art"

[[steps]]
id = "options"
title = "Generate options for {{topic}}"
description = "Propose 2-4 distinct approaches. For each: describe the approach, list trade-offs, estimate effort, identify risks. Be honest about downsides — don't sell a preferred option."
needs = ["research"]
acceptance = "2-4 options documented with trade-offs, effort estimates, and risks for each"

[[steps]]
id = "direction"
title = "Human direction on {{topic}}"
description = "HUMAN GATE. Escalate with the options document. Present the trade-offs clearly. Do NOT proceed until the human selects a direction. Exit with ESCALATED status."
needs = ["options"]
acceptance = "Human has selected a direction and provided any additional constraints"
gate = { type = "human" }

[[steps]]
id = "spec"
title = "Write spec for {{topic}}"
description = "Write a detailed implementation spec based on the chosen direction. Cover: what changes, file-by-file plan, edge cases, migration path (if applicable), testing strategy."
needs = ["direction"]
acceptance = "Spec committed covering approach, files to change, edge cases, and testing strategy"

[[steps]]
id = "spec-review"
title = "Spec review"
description = "HUMAN GATE. Present the spec for review. The human verifies the spec matches their intent before implementation begins. Escalate and wait."
needs = ["spec"]
acceptance = "Human has approved the spec or provided revision feedback (iterate until approved)"
gate = { type = "human" }

[[steps]]
id = "decompose"
title = "Decompose into sub-beads"
description = "Break the approved spec into standard-feature sub-beads. Each sub-bead should be independently implementable and testable. Wire dependencies between them."
needs = ["spec-review"]
acceptance = "Sub-beads created with clear scope, wired as a molecule or with dependencies"

[[steps]]
id = "verify"
title = "Verify against spec"
description = "After all sub-beads complete, verify the aggregate result matches the original spec. Check for integration issues between independently implemented pieces."
needs = ["decompose"]
acceptance = "Implementation matches spec, integration verified, no gaps"

[vars]
[vars.topic]
description = "The architecture decision or design topic"
required = true
[vars.assignee]
description = "Who is assigned to this work"
