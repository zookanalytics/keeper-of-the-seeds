description = "Architecture decision workflow with mandatory human gates. Must NOT proceed to implementation without human direction. Design choices with lasting consequences."
formula = "architecture"
type = "workflow"
version = 1

[[steps]]
id = "research"
title = "Research {{topic}}"
description = "Investigate the problem space. Understand constraints, existing patterns, and prior art. Document findings. Do NOT propose solutions yet — understand the problem first."
acceptance = "Problem space documented with constraints, existing patterns, and relevant prior art"

[[steps]]
id = "options"
title = "Generate options for {{topic}}"
description = "Propose 2-4 distinct approaches. For each: describe the approach, list trade-offs, estimate effort, identify risks. Be honest about downsides — don't sell a preferred option."
needs = ["research"]
acceptance = "2-4 options documented with trade-offs, effort estimates, and risks for each"

[[steps]]
id = "direction"
title = "Human direction on {{topic}}"
description = "HUMAN GATE. Escalate with the options document. Present the trade-offs clearly. Do NOT proceed until the human selects a direction. Exit with ESCALATED status."
needs = ["options"]
acceptance = "Human has selected a direction and provided any additional constraints"
gate = { type = "human" }

[[steps]]
id = "spec"
title = "Write spec for {{topic}}"
description = "Write a detailed implementation spec based on the chosen direction. Cover: what changes, file-by-file plan, edge cases, migration path (if applicable), testing strategy."
needs = ["direction"]
acceptance = "Spec committed covering approach, files to change, edge cases, and testing strategy"

[[steps]]
id = "spec-review"
title = "Spec review"
description = "HUMAN GATE. Present the spec for review. The human verifies the spec matches their intent before implementation begins. Escalate and wait."
needs = ["spec"]
acceptance = "Human has approved the spec or provided revision feedback (iterate until approved)"
gate = { type = "human" }

[[steps]]
id = "decompose"
title = "Decompose into sub-beads"
description = "Break the approved spec into standard-feature sub-beads. Each sub-bead should be independently implementable and testable. Wire dependencies between them."
needs = ["spec-review"]
acceptance = "Sub-beads created with clear scope, wired as a molecule or with dependencies"

[[steps]]
id = "verify"
title = "Verify against spec"
description = "After all sub-beads complete, verify the aggregate result matches the original spec. Check for integration issues between independently implemented pieces."
needs = ["decompose"]
acceptance = "Implementation matches spec, integration verified, no gaps"

[[steps]]
id = "retro"
title = "Retrospective: {{topic}} architecture workflow"
needs = ["verify"]
description = """Analyze this workflow execution and produce a retro document. Review:

1. Process compliance — did each step follow its skill? Were human gates respected?
2. Spec quality — did the spec accurately predict implementation needs? Were there surprises?
3. Decomposition effectiveness — were sub-beads well-scoped? Did any need re-scoping?
4. Rationalizations observed — any moments where agents cut corners, skipped checks, or made excuses? Capture exact rationalizations for skill improvement.
5. Cycle efficiency — where did the human wait unnecessarily? Where could polecats have worked in parallel?
6. Skill gaps — did any step lack a skill that would have helped?

File ks beads for actionable findings. Link to existing ks issues if the pattern is already tracked.
Commit retro document to the branch."""
acceptance = "Retro document committed with findings, ks beads filed for actionable items, rationalizations captured"

[[steps]]
id = "retro-human"
title = "Human retro checkpoint for {{topic}}"
needs = ["retro"]
description = """HUMAN GATE. Present the retro findings to the human. Include:

1. Summary of what worked and what didn't
2. Proposed keeper improvements (skill updates, formula changes)
3. New rationalizations to add to skill tables
4. Beads filed and their priority

Human decides which improvements to pursue. Approved improvements become keeper beads."""
acceptance = "Human has reviewed retro findings and directed which improvements to pursue"
gate = { type = "human" }

[vars]
[vars.topic]
description = "The architecture decision or design topic"
required = true
[vars.assignee]
description = "Who is assigned to this work"
